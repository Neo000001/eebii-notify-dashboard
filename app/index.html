<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Eebii Notify — App</title>
  <link rel="stylesheet" href="/assets/styles.css" />
</head>
<body>
  <header class="header">
    <div class="container row">
      <a class="logo" href="/"><span class="logo-badge">E</span><strong>Eebii Notify</strong></a>
      <div class="row">
        <a class="btn btn-outline" href="#" id="btnConnect">Connect WhatsApp</a>
        <a class="btn" href="/help/">Help</a>
      </div>
    </div>
  </header>

  <main class="container app">
    <aside class="sidebar">
      <div class="section-title">Navigation</div>
      <nav class="menu">
        <a class="active" href="/app/">Dashboard</a>
        <a href="#" onclick="alert('Contacts page coming after wiring DB');return false;">Contacts</a>
        <a href="#" onclick="alert('Templates page coming after Meta link');return false;">Templates</a>
        <a href="#" onclick="alert('Campaigns page coming next');return false;">Campaigns</a>
        <a href="/help/">Help</a>
        <a href="/legal/privacy.html">Privacy</a>
      </nav>
      <div style="margin-top:12px">
        <small class="help">Product of <a href="https://eebii.com" target="_blank">Eebii</a><br>
        WhatsApp <a href="https://wa.me/918848486417">+91 88484 86417</a></small>
      </div>
    </aside>

    <section>
      <div class="grid grid-2">
        <div class="card">
          <h3 id="hi">Welcome</h3>
          <p class="help">Use the quick send form to test your connection. Full contacts/templates/bulk will appear after we wire your DB.</p>

          <form class="grid" onsubmit="return sendQuick(event)">
            <div class="row" style="gap:10px">
              <input class="input" required id="to" placeholder="Recipient phone (e.g. +919999999999)" />
              <input class="input" required id="text" placeholder="Message text" />
              <button class="btn">Send</button>
            </div>
            <small class="help">Powered by your WABA · We don’t store messages.</small>
          </form>

          <pre class="code" id="result" style="margin-top:10px;display:none"></pre>
        </div>

        <div class="card">
          <h3>Status</h3>
          <ul class="help" style="margin:0 0 8px 16px">
            <li>API base: <span class="ok" id="apiBase">/send/text</span></li>
            <li>WhatsApp link: <span class="warn">use “Connect WhatsApp”</span></li>
          </ul>
          <div class="code">curl -X POST "https://eebii-api.onrender.com/send/text"
  -H "Content-Type: application/json"
  -H "X-API-Key: YOUR_API_KEY"
  -d '{"to":"+919999999999","text":"Hello from Eebii!"}'</div>
          <small class="help">Replace <b>YOUR_API_KEY</b> with your Render env <b>API_KEY</b>.</small>
        </div>
      </div>

      <div class="card" style="margin-top:16px">
        <h3>Next</h3>
        <ol class="help">
          <li>Finish <a href="/guide/getting-started.html">Getting Started</a>.</li>
          <li>Submit Meta App Review (whatsapp_business_messaging) when ready.</li>
          <li>We’ll then enable contacts, templates sync, and bulk preview pages.</li>
        </ol>
      </div>
    </section>
  </main>

  <footer>
    <div class="container row" style="justify-content:space-between">
      <div>© <span id="y"></span> Eebii Notify</div>
      <div><a href="/legal/terms.html">Terms</a> · <a href="/legal/privacy.html">Privacy</a></div>
    </div>
  </footer>

  <script>
    document.getElementById('y').textContent=new Date().getFullYear();
    // Friendly locale greeting
    (function(){
      const tz = Intl.DateTimeFormat().resolvedOptions().timeZone||'';
      const hi = document.getElementById('hi');
      const map = [
        [/kolkata|delhi|mumbai|asia\/calcutta/i, 'Namaskāram'],
        [/dubai|muscat/i, 'Marḥaba'],
        [/tokyo|osaka/i, 'Konnichiwa'],
        [/paris|berlin|rome|london/i, 'Hello'],
      ];
      let greet='Hello';
      for (const [re,msg] of map){ if(re.test(tz)){ greet=msg; break; } }
      const hour=new Date().getHours();
      const day = hour<12?'Good morning':hour<18?'Good afternoon':'Good evening';
      hi.textContent = `${greet}! ${day}.`;
    })();

    // Quick send -> FastAPI endpoint
    async function sendQuick(e){
      e.preventDefault();
      const to=document.getElementById('to').value.trim();
      const text=document.getElementById('text').value.trim();
      const resBox=document.getElementById('result');
      resBox.style.display='block';resBox.textContent='Sending...';
      try{
        const r=await fetch('https://eebii-api.onrender.com/send/text',{
          method:'POST',
          headers:{'Content-Type':'application/json','X-API-Key':localStorage.getItem('EEBII_API_KEY')||''},
          body:JSON.stringify({to,text})
        });
        const j=await r.json();
        resBox.textContent=JSON.stringify(j,null,2);
      }catch(err){resBox.textContent='Error: '+err}
      return false;
    }

    // Connect WhatsApp – just navigate to your existing connect endpoint
    document.getElementById('btnConnect').onclick=function(){
      location.href='https://eebii-api.onrender.com/wa/connect';
      return false;
    };
  </script>
</body>
</html>
